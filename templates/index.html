<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор коммерческих предложений</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Переключатель темы -->
    <div class="theme-switcher">
        <div class="theme-toggle" id="themeToggle" title="Переключить тему">
            <svg class="sun" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-12a.75.75 0 0 0 .75-.75V2a.75.75 0 0 0-1.5 0v2.25c0 .414.336.75.75.75zm0 15a.75.75 0 0 0-.75.75V22a.75.75 0 0 0 1.5 0v-2.25A.75.75 0 0 0 12 20zM4.222 5.222a.75.75 0 0 0 1.06 0l1.5-1.5a.75.75 0 0 0-1.06-1.06l-1.5 1.5a.75.75 0 0 0 0 1.06zm14.496 14.496a.75.75 0 0 0 1.06 0l1.5-1.5a.75.75 0 1 0-1.06-1.06l-1.5 1.5a.75.75 0 0 0 0 1.06zM2 12a.75.75 0 0 0 .75.75H5a.75.75 0 0 0 0-1.5H2.75A.75.75 0 0 0 2 12zm17 0a.75.75 0 0 0 .75-.75V9a.75.75 0 0 0-1.5 0v2.25c0 .414.336.75.75.75zm-15.722 6.778a.75.75 0 0 0 0-1.06l-1.5-1.5a.75.75 0 0 0-1.06 1.06l1.5 1.5a.75.75 0 0 0 1.06 0zm14.496-14.496a.75.75 0 0 0 0-1.06l-1.5-1.5a.75.75 0 1 0-1.06 1.06l1.5 1.5a.75.75 0 0 0 1.06 0z"/>
            </svg>
            <svg class="moon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 22c5.523 0 10-4.477 10-10 0-.463-.694-.54-.933-.143a6.5 6.5 0 1 1-8.924-8.924C12.54 2.693 12.463 2 12 2 6.477 2 2 6.477 2 12s4.477 10 10 10z"/>
            </svg>
        </div>
    </div>

    <div class="container mt-4">
        <h1 class="text-center mb-4">Создание коммерческого предложения</h1>
        
        {% include '_messages.html' %}
        
        <form action="{{ url_for('generate') }}" method="post" novalidate>
            <div class="row">
                <!-- Левый столбец -->
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="tender_number" class="form-label">Номер тендера:</label>
                        <input type="text" class="form-control" id="tender_number" name="tender_number" 
                                value="{{ form_data.tender_number if form_data and form_data.tender_number else '' }}">
                    </div>

                    <div class="mb-3">
                        <label for="company" class="form-label">Название компании:</label>
                        <input type="text" class="form-control" id="company" name="company" 
                               value="{{ form_data.company if form_data and form_data.company else '' }}" required>
                        <div class="invalid-feedback">Пожалуйста, укажите название компании.</div>
                    </div>

                    <div class="mb-3">
                        <label for="product" class="form-label">Наименование товара:</label>
                        <input type="text" class="form-control" id="product" name="product" 
                               value="{{ form_data.product if form_data and form_data.product else '' }}" required>
                        <div class="invalid-feedback">Пожалуйста, укажите наименование товара.</div>
                    </div>

                    <div class="mb-3">
                        <label for="quantity" class="form-label">Количество:</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" 
                               value="{{ form_data.quantity if form_data and form_data.quantity else '' }}" min="1" required>
                        <div class="invalid-feedback">Количество должно быть положительным числом.</div>
                    </div>

                    <div class="mb-3">
                        <label for="drawing_number" class="form-label">Номер чертежа:</label>
                        <input type="text" class="form-control" id="drawing_number" name="drawing_number" 
                                value="{{ form_data.drawing_number if form_data and form_data.drawing_number else '' }}">
                    </div>

                    <div class="mb-3">
                        <label for="material" class="form-label">Материал:</label>
                        <input type="text" class="form-control" id="material" name="material" 
                            value="{{ form_data.material if form_data and form_data.material else '' }}">
                    </div>
                </div>

                <!-- Правый столбец -->
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="cost_price" class="form-label">Закупочная стоимость за шт. (руб.):</label>
                        <input type="number" class="form-control" id="cost_price" name="cost_price" 
                               value="{{ form_data.cost_price if form_data and form_data.cost_price else '' }}" step="0.01" min="0.01" required>
                        <div class="invalid-feedback">Цена должна быть положительным числом.</div>
                    </div>

                    <div class="mb-3">
                        <label for="duty_percent" class="form-label">Процент пошлины (%):</label>
                        <input type="number" class="form-control" id="duty_percent" name="duty_percent" 
                            value="{{ form_data.duty_percent if form_data and form_data.duty_percent else '0' }}" step="0.01" min="0" max="100">
                    </div>

                    <div class="mb-3">
                        <label for="weight" class="form-label">Вес за шт. (кг):</label>
                        <input type="number" class="form-control" id="weight" name="weight" 
                               value="{{ form_data.weight if form_data and form_data.weight else '' }}" step="0.01" min="0.01" required>
                        <div class="invalid-feedback">Вес должен быть положительным числом.</div>
                    </div>

                    <div class="mb-3">
                        <label for="logistics" class="form-label">Стоимость логистики (руб.):</label>
                        <input type="number" class="form-control" id="logistics" name="logistics" 
                               value="{{ form_data.logistics if form_data and form_data.logistics else '' }}" step="0.01" min="0" required>
                        <div class="invalid-feedback">Стоимость логистики должна быть неотрицательным числом.</div>
                    </div>

                    <div class="mb-3">
                        <label for="delivery_address" class="form-label">Адрес доставки:</label>
                        <textarea class="form-control" id="delivery_address" name="delivery_address" rows="3">{{ form_data.delivery_address if form_data and form_data.delivery_address else '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Кнопка отправки на всю ширину -->
            <div class="row">
                <div class="col-12">
                    <button type="submit" class="btn btn-primary w-100 mt-3">Сгенерировать КП</button>
                    <div class="form-text mt-2 text-center">Будет скачан ZIP-архив, содержащий файлы Excel и Word.</div>
                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Управление темой
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            
            // Проверяем сохраненную тему или системные настройки
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                html.setAttribute('data-theme', savedTheme);
            } else if (systemPrefersDark) {
                html.setAttribute('data-theme', 'dark');
            }
            
            // Обработчик переключения темы
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
            
            // Следим за изменениями системной темы
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('theme')) {
                    html.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                }
            });
        });

        // Валидация формы
        (function () {
            'use strict'
            var forms = document.querySelectorAll('form')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()
    </script>
</body>
</html>